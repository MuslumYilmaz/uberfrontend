{
    "version": "v2",
    "type": "user-interface",
    "title": "React Autocomplete Search (solution: debounce + keyboard + outside click)",
    "openFile": "/src/App.tsx",
    "dependencies": {
        "react": "18.x",
        "react-dom": "18.x",
        "react-scripts": "5.0.1"
    },
    "files": {
        "/package.json": {
            "code": "{\n  \"name\": \"react-autocomplete-search-solution\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"react\": \"18.x\",\n    \"react-dom\": \"18.x\",\n    \"react-scripts\": \"5.0.1\"\n  },\n  \"scripts\": { \"start\": \"react-scripts start\" }\n}\n"
        },
        "/public/index.html": {
            "code": "<!doctype html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><title>React SDK • Autocomplete (solution)</title></head><body><div id=\"root\"></div></body></html>"
        },
        "/src/index.tsx": {
            "code": "import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\n\ncreateRoot(document.getElementById('root')!).render(<App />);\n"
        },
        "/src/App.tsx": {
            "code": "import React, { useEffect, useRef, useState } from 'react';\nimport './App.css';\n\nconst CITIES: string[] = [\n  'Amsterdam', 'Ankara', 'Athens', 'Austin',\n  'Barcelona', 'Berlin', 'Boston', 'Brussels',\n  'Chicago', 'Copenhagen',\n  'Dubai',\n  'Edinburgh',\n  'Frankfurt',\n  'Hamburg',\n  'Istanbul', 'Izmir',\n  'London', 'Los Angeles',\n  'Madrid', 'Miami', 'Milan', 'Munich',\n  'New York',\n  'Oslo',\n  'Paris', 'Prague',\n  'Rome',\n  'San Diego', 'San Francisco', 'San Jose', 'Seattle',\n  'Tokyo',\n  'Vienna',\n  'Zurich'\n];\n\nfunction sleep(ms: number) {\n  return new Promise<void>((res) => setTimeout(res, ms));\n}\n\nexport default function App() {\n  const rootRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const seqRef = useRef(0);\n\n  const listboxId = 'autocomplete-listbox';\n\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [activeIndex, setActiveIndex] = useState(-1);\n  const [results, setResults] = useState<string[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Debounced search with stale-result protection\n  useEffect(() => {\n    const q = query.trim();\n\n    if (!q) {\n      setIsOpen(false);\n      setActiveIndex(-1);\n      setResults([]);\n      setIsLoading(false);\n      return;\n    }\n\n    setIsOpen(true);\n    setActiveIndex(-1);\n    setIsLoading(true);\n\n    const mySeq = ++seqRef.current;\n\n    const handle = window.setTimeout(async () => {\n      const data = await search(q);\n      if (seqRef.current !== mySeq) return;\n      setResults(data);\n      setIsLoading(false);\n    }, 300);\n\n    return () => {\n      window.clearTimeout(handle);\n    };\n  }, [query]);\n\n  function onFocus() {\n    const q = query.trim();\n    if (q) setIsOpen(true);\n  }\n\n  // NOTE: use DOM KeyboardEvent type (no React namespace)\n  function onKeyDown(ev: KeyboardEvent) {\n    if (ev.key === 'Escape') {\n      setIsOpen(false);\n      setActiveIndex(-1);\n      return;\n    }\n\n    if (!isOpen && (ev.key === 'ArrowDown' || ev.key === 'ArrowUp')) {\n      const q = query.trim();\n      setIsOpen(!!q);\n    }\n\n    const len = results.length;\n    if (!isOpen || len === 0) return;\n\n    if (ev.key === 'ArrowDown') {\n      ev.preventDefault();\n      setActiveIndex((i) => (i < 0 ? 0 : (i + 1) % len));\n      return;\n    }\n\n    if (ev.key === 'ArrowUp') {\n      ev.preventDefault();\n      setActiveIndex((i) => (i < 0 ? len - 1 : (i - 1 + len) % len));\n      return;\n    }\n\n    if (ev.key === 'Enter') {\n      if (activeIndex >= 0 && activeIndex < len) {\n        ev.preventDefault();\n        select(results[activeIndex]);\n      }\n      return;\n    }\n  }\n\n  function select(value: string) {\n    setQuery(value);\n    setIsOpen(false);\n    setActiveIndex(-1);\n  }\n\n  function highlight(item: string, queryRaw: unknown): string {\n    const q = String(queryRaw ?? '').trim();\n    if (!q) return escapeHtml(item);\n\n    const idx = item.toLowerCase().indexOf(q.toLowerCase());\n    if (idx < 0) return escapeHtml(item);\n\n    const before = escapeHtml(item.slice(0, idx));\n    const mid = escapeHtml(item.slice(idx, idx + q.length));\n    const after = escapeHtml(item.slice(idx + q.length));\n    return `${before}<mark>${mid}</mark>${after}`;\n  }\n\n  // Outside click close\n  useEffect(() => {\n    function onDocMouseDown(e: MouseEvent) {\n      const root = rootRef.current;\n      const target = e.target as Node | null;\n      if (!root || !target) return;\n      if (!root.contains(target)) {\n        setIsOpen(false);\n        setActiveIndex(-1);\n      }\n    }\n\n    document.addEventListener('mousedown', onDocMouseDown);\n    return () => document.removeEventListener('mousedown', onDocMouseDown);\n  }, []);\n\n  async function search(q: string): Promise<string[]> {\n    const needle = q.toLowerCase();\n    const filtered = CITIES\n      .filter((c) => c.toLowerCase().includes(needle))\n      .slice(0, 8);\n\n    await sleep(150);\n    return filtered;\n  }\n\n  function escapeHtml(s: string): string {\n    return s\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\\\"/g, '&quot;')\n      .replace(/'/g, '&#39;');\n  }\n\n  const activeDesc = activeIndex >= 0 ? `opt-${activeIndex}` : undefined;\n\n  return (\n    <main className=\"page\">\n      <section className=\"card\">\n        <h1 className=\"title\">Autocomplete</h1>\n\n        <div\n          ref={rootRef}\n          className=\"combo\"\n          role=\"combobox\"\n          aria-haspopup=\"listbox\"\n          aria-expanded={isOpen}\n          aria-owns={listboxId}\n          aria-activedescendant={activeDesc}\n        >\n          <label className=\"label\" htmlFor=\"q\">Search</label>\n          <input\n            ref={inputRef}\n            id=\"q\"\n            className=\"input\"\n            type=\"text\"\n            autoComplete=\"off\"\n            placeholder=\"Type a city...\"\n            value={query}\n            onChange={(e) => setQuery(e.target.value)}\n            onFocus={onFocus}\n            onKeyDown={(e) => onKeyDown(e.nativeEvent)}\n          />\n\n          {isOpen && (\n            <ul className=\"list\" role=\"listbox\" id={listboxId}>\n              {results.map((item, i) => (\n                <li\n                  key={item}\n                  className={i === activeIndex ? 'option active' : 'option'}\n                  role=\"option\"\n                  id={`opt-${i}`}\n                  aria-selected={i === activeIndex}\n                  onMouseDown={() => select(item)}\n                  dangerouslySetInnerHTML={{ __html: highlight(item, query) }}\n                />\n              ))}\n\n              {isLoading && <li className=\"empty\">Loading…</li>}\n              {!isLoading && results.length === 0 && <li className=\"empty\">No results</li>}\n            </ul>\n          )}\n        </div>\n\n        <p className=\"hint\">Keyboard: ↑/↓ navigate, Enter select, Esc close.</p>\n      </section>\n    </main>\n  );\n}\n"
        },
        "/src/App.css": {
            "code": ":root{color-scheme:dark;}html,body{margin:0;height:100%;background:#0a0a0a;}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}\n.page{min-height:100vh;display:grid;place-items:center;padding:24px;background:#0a0a0a;color:#e5e7eb;}\n.card{width:100%;max-width:520px;background:#0b1020;border:1px solid #1f2937;border-radius:14px;padding:18px;display:grid;gap:14px;}\n.title{margin:0;font-size:18px;font-weight:800;}\n.label{display:block;font-size:12px;color:#9ca3af;margin-bottom:6px;}\n.combo{position:relative;}\n.input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #374151;background:#0a0f1e;color:#e5e7eb;outline:none;}\n.input:focus{border-color:#a3e635;box-shadow:0 0 0 2px rgba(163,230,53,.15);}\n.list{position:absolute;z-index:10;left:0;right:0;margin-top:8px;max-height:240px;overflow:auto;border-radius:12px;border:1px solid #1f2937;background:#0a0f1e;}\n.option{padding:10px 12px;cursor:pointer;border-bottom:1px solid rgba(31,41,55,.5);}\n.option:last-child{border-bottom:none;}\n.option.active{background:rgba(163,230,53,.12);}\n.empty{padding:10px 12px;color:#9ca3af;}\n.hint{margin:0;color:#9ca3af;font-size:12px;}\nmark{background:rgba(163,230,53,.25);color:#e5e7eb;border-radius:4px;padding:0 2px;}\n"
        },
        "/tsconfig.json": {
            "code": "{\n  \"compilerOptions\": {\n    \"jsx\": \"react-jsx\",\n    \"target\": \"ES2020\",\n    \"module\": \"ESNext\",\n    \"strict\": true\n  }\n}\n"
        }
    }
}