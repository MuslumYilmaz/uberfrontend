{
    "version": "v2",
    "type": "coding",
    "title": "React \u2022 useEffectOnce",
    "openFile": "src/App.tsx",
    "dependencies": {
        "react": "18.x",
        "react-dom": "18.x",
        "react-scripts": "5.0.1"
    },
    "files": {
        "package.json": "{\n  \"name\": \"react-use-effect-once\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"react\": \"18.x\",\n    \"react-dom\": \"18.x\",\n    \"react-scripts\": \"5.0.1\"\n  },\n  \"scripts\": { \"start\": \"react-scripts start\" }\n}\n",
        "public/index.html": "<!doctype html><html lang=\"en\"><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"><title>React SDK \u2022 useEffectOnce</title></head><body><div id=\"root\"></div></body></html>",
        "src/index.tsx": "import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\n\ncreateRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n",
        "src/App.tsx": "import React, { useMemo, useRef, useState, useEffect } from 'react';\nimport './App.css';\n\ntype EffectCallback = () => void | (() => void);\n\n// TODO: Implement useEffectOnce(effect)\n// Requirements:\n// - Run the effect callback only once per mount (not on re-renders).\n// - If the effect returns a cleanup function, run it on unmount.\n// Notes:\n// - React 18 StrictMode (dev) intentionally runs effects twice (mount -> cleanup -> mount).\n//   We do NOT try to \"defeat\" StrictMode. We only guarantee \"once per mount\".\nfunction useEffectOnce(effect: EffectCallback): void {\n  const didRunRef = useRef(false);\n  const cleanupRef = useRef<void | (() => void)>(undefined);\n\n  useEffect(() => {\n    // TODO: call effect only once per mount and store cleanup in cleanupRef.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n}\n\nfunction Demo({ onEffect }: { onEffect: () => void }) {\n  useEffectOnce(() => {\n    onEffect();\n    return () => {\n      // optional cleanup\n    };\n  });\n\n  return (\n    <div className=\"panel\">\n      <div className=\"label\">Mounted</div>\n      <div className=\"hint\">Effect should increment the counter once per mount. Re-render must not increment it.</div>\n    </div>\n  );\n}\n\nexport default function App() {\n  const [mounted, setMounted] = useState(true);\n  const [renders, setRenders] = useState(0);\n  const [effectRuns, setEffectRuns] = useState(0);\n\n  const onEffect = useMemo(() => () => setEffectRuns((n) => n + 1), []);\n\n  return (\n    <main className=\"page\">\n      <section className=\"card\">\n        <h1 className=\"title\">useEffectOnce</h1>\n        <p className=\"subtitle\">Implement a hook that runs an effect only once per mount.</p>\n\n        <div className=\"stats\">\n          <div className=\"stat\"><div className=\"k\">Renders</div><div className=\"v\">{renders}</div></div>\n          <div className=\"stat\"><div className=\"k\">Effect ran</div><div className=\"v\">{effectRuns}</div></div>\n        </div>\n\n        <div className=\"actions\">\n          <button className=\"btn\" onClick={() => setRenders((n) => n + 1)}>Re-render</button>\n          <button className=\"btn ghost\" onClick={() => setMounted((m) => !m)}>Toggle mount</button>\n          <button className=\"btn ghost\" onClick={() => { setRenders(0); setEffectRuns(0); setMounted(true); }}>Reset</button>\n        </div>\n\n        {mounted ? <Demo onEffect={onEffect} /> : <div className=\"panel\"><div className=\"label\">Unmounted</div></div>}\n\n        <p className=\"foot\">Target: \u201cEffect ran\u201d must not change on re-render; it should increase once per mount.</p>\n      </section>\n    </main>\n  );\n}\n",
        "src/App.css": ":root{color-scheme:dark;}html,body{margin:0;height:100%;background:#0a0a0a;}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}\n.page{min-height:100vh;display:grid;place-items:center;padding:24px;background:#0a0a0a;color:#e5e7eb;}\n.card{width:100%;max-width:620px;background:#0b1020;border:1px solid #1f2937;border-radius:14px;padding:18px;display:grid;gap:14px;}\n.title{margin:0;font-size:18px;font-weight:800;}\n.subtitle{margin:0;color:#9ca3af;font-size:12px;}\n.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;}\n.stat{background:#0a0f1e;border:1px solid #1f2937;border-radius:12px;padding:10px 12px;display:flex;justify-content:space-between;align-items:baseline;}\n.k{color:#9ca3af;font-size:12px;}\n.v{font-size:18px;font-weight:900;}\n.actions{display:flex;gap:8px;flex-wrap:wrap;}\n.btn{background:#a3e635;color:#111;border:none;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;}\n.btn.ghost{background:transparent;color:#e5e7eb;border:1px solid #374151;}\n.panel{background:#0a0f1e;border:1px solid #1f2937;border-radius:12px;padding:12px;display:grid;gap:6px;}\n.label{font-weight:800;}\n.hint{color:#9ca3af;font-size:12px;line-height:1.35;}\n.foot{margin:0;color:#9ca3af;font-size:12px;}\ncode{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.95em;}\n",
        "tsconfig.json": "{\n  \"compilerOptions\": {\n    \"jsx\": \"react-jsx\",\n    \"target\": \"ES2020\",\n    \"module\": \"ESNext\",\n    \"strict\": true\n  }\n}\n"
    }
}
