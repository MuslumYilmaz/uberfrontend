{
    "key": "D",
    "title": "Diagram / Architecture",
    "blocks": [
        {
            "type": "image",
            "src": "https://placehold.co/1200x650/111318/ffffff?text=High-level+Architecture%3A+Edge+%E2%86%92+API+%E2%86%92+Cache%2FDB+%2B+ID+Gen",
            "alt": "High-level architecture showing Edge to API to Cache and DB with ID generation",
            "caption": "Edge POPs terminate TLS and cache redirects; app tier handles writes; Redis + SQL/NoSQL for storage.",
            "width": 1200,
            "height": 650,
            "priority": true
        },
        {
            "type": "text",
            "text": "Components:\n• CDN/Edge: terminate TLS, cache hot tokens, geo-route to nearest POP\n• API Service: shorten(), resolve(), admin endpoints\n• Token Service: k-sorted or base62 IDs (Snowflake, or hash+collision check)\n• Cache: Redis/Memcached cluster with LRU + TTL\n• DB: write-optimized primary + read replicas (e.g., MySQL/InnoDB or DynamoDB)\n• Stream/Analytics: click events to Kafka → OLAP/warehouse"
        },
        {
            "type": "code",
            "language": "sql",
            "code": "-- Relational model (MySQL)\nCREATE TABLE links (\n  token        VARCHAR(12) PRIMARY KEY,\n  original_url TEXT NOT NULL,\n  created_by   BIGINT NULL,\n  created_at   TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  expires_at   TIMESTAMP NULL,\n  is_active    TINYINT(1) DEFAULT 1\n) ENGINE=InnoDB;\n\nCREATE TABLE clicks (\n  token      VARCHAR(12) NOT NULL,\n  ts         TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  country    CHAR(2) NULL,\n  ua_hash    BIGINT NULL,\n  INDEX(token, ts)\n);"
        },
        {
            "type": "code",
            "language": "typescript",
            "code": "// Base62 token generator (example)\nconst ALPH = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\nexport function toBase62(n: number) {\n  if (n === 0) return '0';\n  let s = '';\n  while (n > 0) { s = ALPH[n % 62] + s; n = Math.floor(n / 62); }\n  return s;\n}\n\n// Prefer monotonic IDs (e.g., Snowflake) → then base62 encode\n"
        }
    ]
}