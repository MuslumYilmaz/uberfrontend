[
  {
    "id": "url-shortener",
    "title": "URL Shortener (TinyURL/Bitly)",
    "description": "Design a URL shortener that converts long URLs into short tokens and redirects users to the original URL. Focus on high availability, low latency redirects, and simple analytics.\n\nFunctional requirements:\n- POST an original URL → get a short URL\n- Redirect short URL → 302/301 to original\n- Optional: custom alias, expiry, basic click analytics\n\nNon-functional:\n- p95 redirect latency < 50ms from edge\n- Availability 99.99%\n- Global traffic; reads » writes (≈ 100:1)\n\nData constraints:\n- ~200M active links, ~2B clicks/day at scale\n- Token length 6–8 (62-char alphabet)\n",
    "tags": [
      "api",
      "cache",
      "database",
      "hashing",
      "rate-limits",
      "ttl",
      "cdn"
    ],
    "radio": [
      {
        "key": "R",
        "title": "Reflect & Requirements",
        "blocks": [
          {
            "type": "text",
            "text": "Key user journeys:\n1) Creator submits a long URL and optionally a custom alias or TTL.\n2) Visitor hits short link → fast redirect.\n3) Admin/owner can revoke/expire.\n\nPriorities: ultra-fast reads, global routing, abuse/rate-limits, collision-free tokens."
          },
          {
            "type": "image",
            "src": "https://placehold.co/1000x560/111318/ffffff?text=User+Flow%3A+Create+%E2%86%92+Share+%E2%86%92+Click+%E2%86%92+Redirect",
            "caption": "User flow at a glance"
          }
        ]
      },
      {
        "key": "A",
        "title": "Assumptions & Constraints",
        "blocks": [
          {
            "type": "text",
            "text": "Traffic:\n- Writes: 20k QPS peak (campaign spikes), Reads: 2M QPS peak (global)\n- Token length 7 (62^7 ≈ 3.5e12 space)\n- Hot cache for redirects with TTL≈24h; origin DB as source of truth.\nSecurity/abuse:\n- Per-IP and per-account rate limits\n- Malware/blacklist checks async (quarantine on signal)\n- No PII stored with links by default"
          }
        ]
      },
      {
        "key": "D",
        "title": "Diagram / Architecture",
        "blocks": [
          {
            "type": "image",
            "src": "https://placehold.co/1200x650/111318/ffffff?text=High-level+Architecture%3A+Edge+%E2%86%92+API+%E2%86%92+Cache%2FDB+%2B+ID+Gen",
            "caption": "Edge POPs terminate TLS and cache redirects; app tier handles writes; Redis + SQL/NoSQL for storage."
          },
          {
            "type": "text",
            "text": "Components:\n• CDN/Edge: terminate TLS, cache hot tokens, geo-route to nearest POP\n• API Service: shorten(), resolve(), admin endpoints\n• Token Service: k-sorted or base62 IDs (Snowflake, or hash+collision check)\n• Cache: Redis/Memcached cluster with LRU + TTL\n• DB: write-optimized primary + read replicas (e.g., MySQL/InnoDB or DynamoDB)\n• Stream/Analytics: click events to Kafka → OLAP/warehouse"
          },
          {
            "type": "code",
            "language": "sql",
            "code": "-- Relational model (MySQL)\nCREATE TABLE links (\n  token        VARCHAR(12) PRIMARY KEY,\n  original_url TEXT NOT NULL,\n  created_by   BIGINT NULL,\n  created_at   TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  expires_at   TIMESTAMP NULL,\n  is_active    TINYINT(1) DEFAULT 1\n) ENGINE=InnoDB;\n\nCREATE TABLE clicks (\n  token      VARCHAR(12) NOT NULL,\n  ts         TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  country    CHAR(2) NULL,\n  ua_hash    BIGINT NULL,\n  INDEX(token, ts)\n);"
          },
          {
            "type": "code",
            "language": "typescript",
            "code": "// Base62 token generator (example)\nconst ALPH = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\nexport function toBase62(n: number) {\n  if (n === 0) return '0';\n  let s = '';\n  while (n > 0) { s = ALPH[n % 62] + s; n = Math.floor(n / 62); }\n  return s;\n}\n\n// Prefer monotonic IDs (e.g., Snowflake) → then base62 encode\n"
          }
        ]
      },
      {
        "key": "I",
        "title": "Interfaces & APIs",
        "blocks": [
          {
            "type": "text",
            "text": "Redirect should be a bare GET /:token that returns 302 by default (or 301 if permanent requested at creation). API is versioned under /api/v1."
          },
          {
            "type": "code",
            "language": "http",
            "code": "POST /api/v1/shorten HTTP/1.1\nContent-Type: application/json\n\n{\n  \"url\": \"https://example.com/products/123?ref=campaign\",\n  \"customAlias\": \"sale-123\",\n  \"expiresInDays\": 30\n}\n"
          },
          {
            "type": "code",
            "language": "json",
            "code": "{\n  \"shortUrl\": \"https://uf.to/sale-123\",\n  \"token\": \"sale-123\",\n  \"expiresAt\": \"2026-01-01T00:00:00Z\"\n}"
          },
          {
            "type": "code",
            "language": "http",
            "code": "GET /sale-123 HTTP/1.1\n→ 302 Location: https://example.com/products/123?ref=campaign\nCache-Control: public, max-age=300\n"
          },
          {
            "type": "text",
            "text": "Rate limits: 60 req/min per IP for POST /shorten (burst=20). Custom alias conflicts return 409. Admin can DELETE /api/v1/links/:token to revoke."
          }
        ]
      },
      {
        "key": "O",
        "title": "Operations & Trade-offs",
        "blocks": [
          {
            "type": "text",
            "text": "Cache strategy: cache positive and negative lookups with short TTL to protect DB from miss-storms. Evict on revoke.\nConsistency: write path checks collisions (unique token). In DynamoDB, use conditional put; in SQL, handle duplicate key retry.\nBackups: PITR on primary data; tokens are small—backups cheap.\nAnalytics: async fire-and-forget to Kafka; never block redirect path.\nAbuse: shadow-ban suspected domains; async malware scan; flag and quarantine.\nDisaster recovery: multi-region active-active for read path; writes geo-partitioned with async replication."
          },
          {
            "type": "image",
            "src": "https://placehold.co/1000x420/111318/ffffff?text=Ops%2FTrade-offs+Overview",
            "caption": "Hot path stays lean; heavy work is async."
          }
        ]
      }
    ]
  }
]