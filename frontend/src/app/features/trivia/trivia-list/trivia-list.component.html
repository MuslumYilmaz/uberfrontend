<div class="fa-page-shell trivia-list-page" data-testid="trivia-list-page">
    <header class="fa-page-header">
        <p class="fa-page-kicker">Quiz practice</p>
        <h1 class="fa-page-title">{{ tech | titlecase }} Trivia Questions</h1>
        <p class="fa-page-subtitle">Filter by difficulty and importance to train faster before interviews.</p>
    </header>

    <div class="trivia-filter-bar fa-section-shell">
        <div class="trivia-filter-item trivia-filter-item--search">
            <div class="trivia-search-wrap">
                <i class="pi pi-search trivia-search-icon"></i>
                <input pInputText type="text" placeholder="Search by title…"
                    class="trivia-search-input"
                    (input)="search$.next($any($event.target).value)" />
            </div>
        </div>

        <div class="trivia-filter-item">
            <p-multiSelect class="difficulty-filter p-multiselect-dark" [options]="difficultyOptions"
                placeholder="Difficulty" display="chip" optionLabel="label" optionValue="value"
                panelStyleClass="dark-multiselect-panel rounded-lg" (onChange)="diffs$.next($event.value)">
            </p-multiSelect>
        </div>

        <div class="trivia-filter-item">
            <label class="trivia-slider-label">Max Importance</label>
            <p-slider [(ngModel)]="sliderValue" [min]="1" [max]="5" [step]="1" class="w-full"
                (ngModelChange)="maxImp$.next($event)"></p-slider>
        </div>
    </div>

    <div class="trivia-list-table fa-section-shell">
        <div class="trivia-table-head hidden md:grid grid-cols-12 gap-4">
            <div class="col-span-5">Title</div>
            <div class="col-span-2">Difficulty</div>
            <div class="col-span-1">Importance</div>
            <div class="col-span-3">Tags</div>
            <div class="col-span-1 text-right">Action</div>
        </div>

        <ng-container *ngIf="(rawQuestions$ | async) === null; else loaded">
            <div class="trivia-loading" role="status" aria-live="polite" data-testid="trivia-list-loading">
                <p-progressSpinner></p-progressSpinner>
                <div class="trivia-loading-text">Loading trivia questions…</div>
            </div>
        </ng-container>

        <ng-template #loaded>
            <ng-container *ngIf="filtered$ | async as questions">
                <div *ngIf="questions.length === 0" class="fa-empty-state">
                    No trivia questions match your filters.
                </div>

                <div *ngFor="let q of questions"
                    class="trivia-row grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4 items-start md:items-center"
                    data-testid="trivia-row"
                    (click)="navigateTo(q)">
                    <div class="md:col-span-5">
                        <div class="trivia-row-title">{{ q.title }}</div>
                        <div class="trivia-row-desc">{{ descriptionText(q) | slice:0:80 }}...</div>

                        <div class="mt-2 flex flex-wrap items-center gap-2 md:hidden">
                            <span class="difficulty-pill" [ngClass]="{
                  'pill--easy': q.difficulty === 'easy',
                  'pill--intermediate': q.difficulty === 'intermediate',
                  'pill--hard': q.difficulty === 'hard'
                }">{{ q.difficulty | titlecase }}</span>
                            <span class="trivia-mobile-meta">Importance: {{ q.importance }}</span>
                        </div>
                    </div>
                    <div class="hidden md:block md:col-span-2">
                        <span class="difficulty-pill" [ngClass]="{
                  'pill--easy': q.difficulty === 'easy',
                  'pill--intermediate': q.difficulty === 'intermediate',
                  'pill--hard': q.difficulty === 'hard'
                }">{{ q.difficulty | titlecase }}</span>
                    </div>
                    <div class="hidden md:block md:col-span-1">
                        <div class="trivia-importance">{{ q.importance }}</div>
                    </div>
                    <div class="md:col-span-3 flex flex-nowrap md:flex-wrap gap-2 overflow-x-auto md:overflow-visible pb-1 md:pb-0">
                        <p-chip *ngFor="let tag of q.tags" [label]="tag" styleClass="custom-chip"></p-chip>
                    </div>
                    <div class="hidden md:block md:col-span-1 text-right">
                        <span class="trivia-action">→ Answer</span>
                    </div>
                </div>
            </ng-container>
        </ng-template>
    </div>
</div>
