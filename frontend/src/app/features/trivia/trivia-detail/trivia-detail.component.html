<!-- ========================= trivia-detail.component.html ========================= -->
<div class="page-frame">
    <!-- Sidebar -->
    <aside class="side">
        <div class="side-head">
            <div class="side-title">All Questions</div>
        </div>
        <ul class="side-list">
            <li *ngFor="let q of questionsList">
                <button class="side-item" [class.is-active]="isActive(q)" (click)="onSelect(q)">
                    <div class="side-item-main">
                        <div class="side-item-title">{{ q.title }}</div>
                        <span class="chip chip-premium" *ngIf="q.access === 'premium'">Premium</span>
                    </div>
                    <div class="side-item-tail">
                        <i class="fa-solid fa-chevron-right" *ngIf="!isActive(q)"></i>
                    </div>
                </button>
            </li>
        </ul>
    </aside>

    <!-- Detail -->
    <main class="main">
        <div *ngIf="question() as q; else missing" class="main-stack">
            <ng-container *ngIf="!locked(); else lockedView">
            <!-- Title + chips -->
            <header class="title-block">
                <div class="title-row">
                    <h1 class="title">{{ q.title }}</h1>
                    <span class="solved-pill" *ngIf="solved()" aria-label="Solved">
                        <i class="fa-solid fa-check"></i>
                        Solved
                    </span>
                </div>
                <div class="meta-chips">
                    <span class="chip chip-freq">{{ importanceLabel(q.importance) }}</span>
                    <span class="chip chip-diff">{{ difficultyLabel(q.difficulty) }}</span>
                    <span class="chip chip-tech">{{ (q.technology || 'â€”') | titlecase }}</span>
                    <span class="chip chip-premium" *ngIf="locked()">Premium</span>
                </div>
            </header>

            <!-- Quick Answer -->
            <section class="card">
                <div class="card-head">Quick Answer</div>
                <div class="card-body">
                    <div class="content" [innerHTML]="md(descText(q.description))"></div>
                </div>
            </section>

            <!-- Answer -->
            <section class="card">
                <div class="card-head">Answer</div>
                <div class="card-body">
                    <ng-container *ngIf="answerIsRich(); else simpleAnswer">
                        <div class="blocks">
                            <ng-container *ngFor="let b of answerBlocks(); let i = index">
                                <!-- TEXT -->
                                <div *ngIf="b.type === 'text'" class="block b-text">
                                    <div class="content" [innerHTML]="md($any(b).text)"></div>
                                </div>

                                <!-- CODE -->
                                <div *ngIf="b.type === 'code'" class="block b-code">
                                    <div class="code-head">
                                        <span class="lang">{{ ($any(b).language || 'javascript') | uppercase }}</span>
                                        <div class="code-actions">
                                            <span class="copied-pill" *ngIf="copiedIndex() === i">
                                                <i class="fa-solid fa-check"></i> Copied
                                            </span>
                                            <button pButton type="button" class="btn-copy p-button-sm p-button-text"
                                                [title]="copiedIndex() === i ? 'Copied' : 'Copy to clipboard'"
                                                (click)="copy($any(b).code, i)">
                                                <i class="fa-solid"
                                                    [ngClass]="copiedIndex() === i ? 'fa-check' : 'fa-copy'"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <pre class="line-numbers">
<code prism [lang]="$any(b).language || 'javascript'" [code]="dedent($any(b).code)"></code>
                  </pre>
                                </div>

                                <!-- IMAGE -->
                                <figure *ngIf="b.type === 'image'" class="block b-image">
                                    <img [src]="$any(b).src" [alt]="$any(b).alt || 'diagram'"
                                        [width]="$any(b).width || null" [height]="$any(b).height || null" loading="lazy"
                                        decoding="async" />
                                    <figcaption *ngIf="$any(b).caption as cap">{{ cap }}</figcaption>
                                </figure>

                                <!-- LIST (table) -->
                                <figure *ngIf="b.type === 'list'" class="block b-list">
                                    <div class="table-scroll" role="region" aria-label="comparison table">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th *ngFor="let col of $any(b).columns" [innerHTML]="md(col)"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let row of $any(b).rows">
                                                    <td *ngFor="let cell of row" [innerHTML]="md(cell)"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <figcaption *ngIf="$any(b).caption as cap" class="tbl-caption">{{ cap }}
                                    </figcaption>
                                </figure>
                            </ng-container>
                        </div>
                    </ng-container>

                    <!-- Simple string fallback (markdown-rendered) -->
                    <ng-template #simpleAnswer>
                        <div class="content" *ngIf="q.answer; else noAnswer" [innerHTML]="md(q.answer)"></div>
                        <ng-template #noAnswer>
                            <p class="content muted">Answer coming soon.</p>
                        </ng-template>
                    </ng-template>
                </div>
            </section>

            <!-- Still so complicated? -->
            <section class="card" *ngIf="extraHelp()">
                <div class="card-head">Still so complicated?</div>
                <div class="card-body tip-body">
                    <div class="content" [innerHTML]="extraHelp()"></div>
                </div>
            </section>

            <!-- Summary -->
            <section class="card" *ngIf="summaryHelp()">
                <div class="card-head">Summary</div>
                <div class="card-body">
                    <div class="content" [innerHTML]="summaryHelp()"></div>
                </div>
            </section>
            </ng-container>
        </div>

        <ng-template #missing>
            <div class="empty">
                <div class="empty-text">Question not found.</div>
            </div>
        </ng-template>
        <ng-template #lockedView>
            <div class="locked-shell">
                <div class="locked-card">
                    <div class="locked-pill">Premium</div>
                    <h1 class="locked-title">Premium question</h1>
                    <p class="locked-copy">
                        <ng-container *ngIf="auth.isLoggedIn(); else lockedGuest">
                            You're on the free tier. Upgrade to view this answer.
                        </ng-container>
                        <ng-template #lockedGuest>
                            Upgrade to FrontendAtlas Premium to view this answer. Already upgraded? Sign in to continue.
                        </ng-template>
                    </p>
                    <div class="locked-actions">
                        <button class="fa-btn fa-btn--primary" type="button" (click)="goToPricing()">View pricing</button>
                        <button *ngIf="!auth.isLoggedIn()" class="fa-btn fa-btn--ghost" type="button" (click)="goToLogin()">Sign in</button>
                    </div>
                </div>
            </div>
        </ng-template>
    </main>
</div>

<!-- Global a11y announcer (fixed off-screen, no layout shift) -->
<div id="sr-announcer" aria-live="polite" class="sr-announcer-fixed"></div>

<app-login-required-dialog [(visible)]="loginPromptOpen" title="Sign in to save progress"
    body="To track completed questions and keep your progress synced, sign in or create a free account."
    ctaLabel="Go to login">
</app-login-required-dialog>

<!-- Footer -->
<app-footer [mode]="'practice'" [progressText]="progressText()" [prevDisabled]="!hasPrev()" [nextDisabled]="!hasNext()"
    [showSubmit]="true" [submitLabel]="submitLabel()" (submit)="markComplete()" (prev)="prev()" (next)="next()"
    (back)="returnTo ? router.navigate(returnTo) : null">
</app-footer>
