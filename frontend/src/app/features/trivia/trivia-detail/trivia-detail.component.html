<div class="page-frame">
    <!-- Sidebar -->
    <aside class="side">
        <div class="side-head">
            <div class="side-title">All Questions</div>
        </div>

        <ul class="side-list">
            <li *ngFor="let q of questionsList">
                <button class="side-item" [class.is-active]="isActive(q)" (click)="onSelect(q)">
                    <div class="side-item-main">
                        <div class="side-item-title">{{ q.title }}</div>
                        <div class="side-item-desc line-clamp-2">
                            {{ descText(q.description) }}
                        </div>
                    </div>
                    <div class="side-item-tail">
                        <i class="fa-solid fa-chevron-right" *ngIf="!isActive(q)"></i>
                    </div>
                </button>
            </li>
        </ul>
    </aside>

    <!-- Detail -->
    <main class="main">
        <div *ngIf="question() as q; else missing" class="main-stack">
            <!-- Title + chips -->
            <header class="title-block">
                <h1 class="title">{{ q.title }}</h1>

                <div class="meta-chips">
                    <span class="chip chip-freq">{{ importanceLabel(q.importance) }}</span>
                    <span class="chip chip-diff">{{ difficultyLabel(q.difficulty) }}</span>
                    <span class="chip chip-tech">{{ (q.technology || 'â€”') | titlecase }}</span>
                </div>
            </header>

            <!-- Question -->
            <section class="card">
                <div class="card-head">Question</div>
                <div class="card-body">
                    <div class="content" [innerHTML]="md(descText(q.description))"></div>
                </div>
            </section>

            <!-- Answer -->
            <section class="card">
                <div class="card-head">Answer</div>
                <div class="card-body">
                    <ng-container *ngIf="answerIsRich(); else simpleAnswer">
                        <div class="blocks">
                            <ng-container *ngFor="let b of answerBlocks(); let i = index">
                                <!-- TEXT -->
                                <div *ngIf="b.type === 'text'" class="block b-text">
                                    <div class="content" [innerHTML]="md($any(b).text)"></div>
                                </div>

                                <!-- CODE -->
                                <div *ngIf="b.type === 'code'" class="block b-code">
                                    <div class="code-head">
                                        <span class="lang">{{ ($any(b).language || 'javascript') | uppercase }}</span>

                                        <div class="code-actions">
                                            <span class="copied-pill" *ngIf="copiedIndex() === i">
                                                <i class="fa-solid fa-check"></i> Copied
                                            </span>

                                            <button pButton type="button" class="btn-copy p-button-sm p-button-text"
                                                [title]="copiedIndex() === i ? 'Copied' : 'Copy to clipboard'"
                                                (click)="copy($any(b).code, i)">
                                                <i class="fa-solid"
                                                    [ngClass]="copiedIndex() === i ? 'fa-check' : 'fa-copy'"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <pre class="line-numbers">
                    <code prism
                          [lang]="$any(b).language || 'javascript'"
                          [code]="dedent($any(b).code)">
                    </code>
                  </pre>
                                </div>

                                <!-- IMAGE -->
                                <figure *ngIf="b.type === 'image'" class="block b-image">
                                    <img [src]="$any(b).src" [alt]="$any(b).alt || 'diagram'"
                                        [width]="$any(b).width || null" [height]="$any(b).height || null" loading="lazy"
                                        decoding="async" />
                                    <figcaption *ngIf="$any(b).caption as cap">{{ cap }}</figcaption>
                                </figure>
                            </ng-container>
                        </div>
                    </ng-container>

                    <!-- Simple string fallback (markdown-rendered) -->
                    <ng-template #simpleAnswer>
                        <div class="content" *ngIf="q.answer; else noAnswer" [innerHTML]="md(q.answer)"></div>
                        <ng-template #noAnswer>
                            <p class="content muted">Answer coming soon.</p>
                        </ng-template>
                    </ng-template>
                </div>
            </section>
        </div>

        <ng-template #missing>
            <div class="empty">
                <div class="empty-text">Question not found.</div>
            </div>
        </ng-template>
    </main>
</div>

<!-- Global a11y announcer (fixed off-screen, never affects layout) -->
<div id="sr-announcer" aria-live="polite" class="sr-announcer-fixed"></div>

<!-- Footer -->
<app-footer [mode]="'practice'" [progressText]="progressText()" [prevDisabled]="!hasPrev()" [nextDisabled]="!hasNext()"
    (prev)="prev()" (next)="next()" (back)="returnTo ? router.navigate(returnTo) : null">
</app-footer>