<div class="profile-layout" *ngIf="!loading(); else loadingTpl">
    <!-- Sidebar -->
    <aside class="profile-sidebar">
        <div class="avatar-lg">{{ user()?.username?.[0] || '?' }}</div>

        <h2 class="name">{{ user()?.username }}</h2>
        <span class="badge-premium" *ngIf="user()?.role === 'admin'">‚≠ê Premium</span>

        <p class="email">{{ user()?.email }}</p>

        <ul class="profile-info">
            <li><i class="pi pi-id-card"></i> {{ user()?._id }}</li>
            <li><i class="pi pi-calendar"></i> Joined on {{ user()?.createdAt | date:'dd.MM.yyyy' }}</li>
        </ul>

        <button class="discord-btn">
            <i class="pi pi-discord"></i> Join Premium Discord
        </button>
    </aside>

    <!-- Main Content -->
    <main class="profile-main">
        <nav class="tabs">
            <button [class.active]="tab() === 'activity'" (click)="tab.set('activity')">Activity</button>
            <button [class.active]="tab() === 'account'" (click)="tab.set('account')">Account</button>
            <button [class.active]="tab() === 'billing'" (click)="tab.set('billing')">Billing</button>
            <button [class.active]="tab() === 'security'" (click)="tab.set('security')">Security</button>
            <button [class.active]="tab() === 'coupons'" (click)="tab.set('coupons')">Coupons</button>
        </nav>

        <!-- Activity -->
        <section *ngIf="tab() === 'activity'" class="panel">
            <div class="stats-card">
                <div class="stat">
                    <div class="value">üî• 12</div>
                    <div class="label">Day streak</div>
                </div>
                <div class="stat">
                    <div class="value">‚≠ê 2450</div>
                    <div class="label">Total XP</div>
                </div>
                <div class="stat">
                    <div class="value">72%</div>
                    <div class="label">Completion</div>
                </div>
            </div>

            <div class="section">
                <h3>Recent Activity</h3>
                <ul>
                    <li>Solved ‚ÄúArray Flatten‚Äù</li>
                    <li>Answered 5 Trivia questions</li>
                    <li>Fixed a bug in Debug practice</li>
                </ul>
            </div>

            <div class="section">
                <h3>Achievements</h3>
                <div class="badges">
                    <span class="badge">üèÜ 7-day Streak</span>
                    <span class="badge">üí° 100 Trivia</span>
                    <span class="badge">üíª 50 Exercises</span>
                </div>
            </div>
        </section>

        <!-- Account -->
        <section *ngIf="tab() === 'account'" class="panel">
            <div class="account-card">
                <h4>Name</h4>
                <p class="desc">This is the name that will be shown on your profile.</p>
                <input [(ngModel)]="editName" maxlength="32" />
                <div class="helper">{{ editName?.length }}/32</div>
                <button class="btn-save" (click)="saveAccountChanges()">Save changes</button>
            </div>

            <div class="account-card">
                <h4>Username</h4>
                <p class="desc">This is your unique username.</p>
                <input [(ngModel)]="editUsername" maxlength="48" />
                <div class="helper">{{ editUsername?.length }}/48</div>
                <button class="btn-save" (click)="saveAccountChanges()">Save changes</button>
            </div>

            <div class="account-card">
                <h4>Email</h4>
                <p class="desc">Change your email here to log in with email/password instead of OAuth.</p>
                <input [(ngModel)]="editEmail" />
                <button class="btn-save" (click)="saveAccountChanges()">Save changes</button>
            </div>

            <div class="account-card">
                <h4>Social Providers</h4>
                <p class="desc">Manage your connected social accounts (e.g. GitHub, Google).</p>
                <button class="btn-disabled" disabled>GitHub connected</button>
            </div>
        </section>

        <!-- Billing -->
        <section *ngIf="tab() === 'billing'" class="panel">
            <div class="account-card">
                <h4>UberFrontend Pro</h4>
                <p class="desc">You are on the Lifetime plan.</p>
            </div>

            <div class="account-card">
                <h4>UberFrontend Projects</h4>
                <p class="desc">You are not subscribed. <a href="#">View subscription plans</a></p>
                <div class="promo">
                    <strong>Upgrade to Premium Projects</strong>
                    <p>Get access to premium challenges, guides, and exclusive tracks.</p>
                </div>
            </div>

            <div class="account-card">
                <h4>Manage subscription</h4>
                <p class="desc">Manage your subscription and payment methods via Stripe.</p>
                <button class="btn-save">Manage on Stripe</button>
            </div>
        </section>

        <!-- Security -->
        <section *ngIf="tab() === 'security'" class="panel">
            <div class="account-card">
                <h4>Change password</h4>
                <p class="desc">
                    If you are logged in with OAuth, you can set a password here
                    to use email and password to log in instead.
                </p>

                <label class="field">
                    <span>* Password</span>
                    <input type="password" [(ngModel)]="password" placeholder="Enter new password" />
                    <small>Minimum 8 characters. Letters and digits required.</small>
                </label>

                <label class="field">
                    <span>* Repeat Password</span>
                    <input type="password" [(ngModel)]="repeatPassword" placeholder="Repeat new password" />
                </label>

                <button class="btn-save" [disabled]="!canChangePassword()">Change password</button>
            </div>
        </section>

        <!-- Coupons -->
        <section *ngIf="tab() === 'coupons'" class="panel">
            <h3>Coupons</h3>
            <p>No coupons available.</p>
        </section>
    </main>
</div>

<ng-template #loadingTpl>
    <p style="padding:20px;">Loading profile...</p>
</ng-template>