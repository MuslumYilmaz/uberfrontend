<button class="sidebar-toggle" type="button" (click)="toggleDrawer()" aria-label="Open menu">
    <span></span><span></span><span></span>
</button>

<aside class="sidebar" [class.is-collapsed]="collapsed" [class.is-open]="drawerOpen()">
    <nav class="nav">
        <div class="nav-section nav-section--top" *ngIf="isLink(nav[0])">
            <ul>
                <li>
                    <a class="nav-link" [routerLink]="$any(nav[0]).to" [queryParams]="$any(nav[0]).query || null"
                        routerLinkActive="is-active" [routerLinkActiveOptions]="{ exact: true }"
                        aria-label="Home">
                        <i class="pi nav-ic pi-compass"></i>
                        <span class="label">Home base</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="nav-section">
            <p class="section-heading">Practice</p>
            <ng-container *ngIf="isGroup(nav[1])">
                <div class="nav-group nav-block">
                    <button class="group-header" type="button" (click)="toggleGroup(1)"
                        [attr.aria-expanded]="$any(nav[1]).open" [attr.aria-controls]="'group-1'">
                        <i class="pi nav-ic pi-box"></i>
                        <span class="label">Practice catalog</span>
                        <i class="pi caret" [ngClass]="$any(nav[1]).open ? 'pi-chevron-down' : 'pi-chevron-right'"></i>
                    </button>

                    <div class="group-list" [id]="'group-1'" [class.open]="$any(nav[1]).open">
                        <ul class="group-inner">
                            <li>
                                <a class="nav-sublink" [routerLink]="$any(nav[1]).children[0].to"
                                    [queryParams]="$any(nav[1]).children[0].query || null" routerLinkActive="is-active"
                                    [routerLinkActiveOptions]="{ exact: true }" aria-label="Question library">
                                    <i class="pi nav-ic pi-database"></i>
                                    <span class="label">Question library</span>
                                </a>
                            </li>
                            <li>
                                <a class="nav-sublink" [routerLink]="$any(nav[1]).children[1].to"
                                    [queryParams]="$any(nav[1]).children[1].query || null" routerLinkActive="is-active"
                                    [routerLinkActiveOptions]="{ exact: true }" aria-label="Interview prep tracks">
                                    <i class="pi nav-ic pi-server"></i>
                                    <span class="label">Interview prep tracks</span>
                                </a>
                            </li>
                            <li>
                                <a class="nav-sublink" [routerLink]="$any(nav[1]).children[2].to"
                                    [queryParams]="$any(nav[1]).children[2].query || null" routerLinkActive="is-active"
                                    [routerLinkActiveOptions]="{ exact: true }" aria-label="Question styles">
                                    <i class="pi nav-ic pi-clone"></i>
                                    <span class="label">Question styles</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </ng-container>
        </div>

        <div class="nav-section">
            <p class="section-heading">Study</p>

            <ng-container *ngIf="isGroup(nav[2])">
                <div class="nav-group nav-block">
                    <button class="group-header" type="button" (click)="toggleGroup(2)"
                        [attr.aria-expanded]="$any(nav[2]).open" [attr.aria-controls]="'group-2'">
                        <i class="pi nav-ic pi-directions-alt"></i>
                        <span class="label">Study paths</span>
                        <i class="pi caret" [ngClass]="$any(nav[2]).open ? 'pi-chevron-down' : 'pi-chevron-right'"></i>
                    </button>

                    <div class="group-list" [id]="'group-2'" [class.open]="$any(nav[2]).open">
                        <ul class="group-inner">
                            <li *ngFor="let c of $any(nav[2]).children">
                                <a class="nav-sublink" [routerLink]="c.to" [queryParams]="c.query || null"
                                    routerLinkActive="is-active" [routerLinkActiveOptions]="{ exact: true }"
                                    [attr.aria-label]="c.label">
                                    <i class="pi nav-ic pi-directions"></i>
                                    <span class="label">{{ c.label }}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </ng-container>

            <ng-container *ngIf="isGroup(nav[3])">
                <div class="nav-group nav-block">
                    <button class="group-header" type="button" (click)="toggleGroup(3)"
                        [attr.aria-expanded]="$any(nav[3]).open" [attr.aria-controls]="'group-3'">
                        <i class="pi nav-ic pi-bookmark"></i>
                        <span class="label">Reference guides</span>
                        <i class="pi caret" [ngClass]="$any(nav[3]).open ? 'pi-chevron-down' : 'pi-chevron-right'"></i>
                    </button>

                    <div class="group-list" [id]="'group-3'" [class.open]="$any(nav[3]).open">
                        <ul class="group-inner">
                            <li *ngFor="let c of $any(nav[3]).children">
                                <a class="nav-sublink" [routerLink]="c.to" [queryParams]="c.query || null"
                                    routerLinkActive="is-active" [routerLinkActiveOptions]="{ exact: true }"
                                    [attr.aria-label]="c.label">
                                    <i class="pi nav-ic pi-book"></i>
                                    <span class="label">{{ c.label }}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </ng-container>
        </div>

        <div class="nav-section">
            <p class="section-heading">Productivity</p>
            <ng-container *ngIf="isGroup(nav[4])">
                <div class="nav-group nav-block">
                    <button class="group-header nav-link--pill" type="button" (click)="toggleGroup(4)"
                        [attr.aria-expanded]="$any(nav[4]).open" [attr.aria-controls]="'group-4'">
                        <i class="pi nav-ic pi-stopwatch"></i>
                        <span class="label">Shortcuts &amp; tools</span>
                        <i class="pi caret" [ngClass]="$any(nav[4]).open ? 'pi-chevron-down' : 'pi-chevron-right'"></i>
                    </button>

                    <div class="group-list" [id]="'group-4'" [class.open]="$any(nav[4]).open">
                        <ul class="group-inner">
                            <li *ngFor="let c of $any(nav[4]).children">
                                <a class="nav-sublink" [routerLink]="c.to" [queryParams]="c.query || null"
                                    routerLinkActive="is-active" [routerLinkActiveOptions]="{ exact: true }"
                                    [attr.aria-label]="c.label">
                                    <i class="pi nav-ic" [ngClass]="c.icon || 'pi pi-link'"></i>
                                    <span class="label">{{ c.label }}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </ng-container>
        </div>
    </nav>

    <!-- bottom tools -->
    <div class="tools">
        <div class="tools-left">
            <!-- Bug -->
            <button class="tool-icon-btn" type="button" pTooltip="Report a bug" tooltipPosition="right"
                (click)="openBugModal()" aria-label="Report a bug">
                <i class="pi pi-exclamation-triangle"></i>
            </button>

            <!-- Legal -->
            <button pButton type="button" icon="pi pi-shield" class="p-button-text p-button-icon-only legal-btn"
                [routerLink]="['/legal']" pTooltip="Legal" tooltipPosition="right" aria-label="Legal">
            </button>
        </div>

        <div class="tools-right">
            <button pButton type="button" [icon]="collapsed ? 'pi pi-chevron-right' : 'pi pi-chevron-left'"
                class="p-button-rounded p-button-text p-button-icon-only" (click)="toggleCollapsed()"
                pTooltip="{{ collapsed ? 'Expand sidebar' : 'Collapse sidebar' }}" tooltipPosition="right"
                [attr.aria-label]="collapsed ? 'Expand sidebar' : 'Collapse sidebar'">
            </button>
        </div>
    </div>



    <!-- Bug report dialog -->
    <p-dialog [(visible)]="bugVisible" [modal]="true" [appendTo]="'body'" styleClass="bug-dialog" [showHeader]="false"
        [baseZIndex]="10000">
        <!-- header -->
        <div class="bug-dialog__header">
            <span>Report a bug</span>
            <button type="button" (click)="bugVisible=false" aria-label="Close"
                class="p-dialog-header-icon p-dialog-header-close p-link bug-dialog__close">
                <span class="p-dialog-header-close-icon pi pi-times"></span>
            </button>
        </div>

        <!-- body -->
        <div class="bug-body">
            <label for="bug-note" class="bug-label">What went wrong?</label>

            <textarea id="bug-note" pInputTextarea [(ngModel)]="bugText" [autoResize]="true" rows="6"
                class="bug-textarea"
                placeholder="Describe the issue, steps to reproduce, and what you expected to happen."></textarea>

            <div class="bug-actions">
                <button pButton type="button" label="Cancel" (click)="closeBugModal()" [disabled]="submitting"
                    class="bug-btn bug-btn--cancel">
                </button>

                <button pButton type="button" label="Send" (click)="submitBug()"
                    [disabled]="!bugText.trim() || submitting" [loading]="submitting"
                    class="bug-btn bug-btn--primary">
                </button>
            </div>

            <div *ngIf="submitOk" class="bug-success">
                Thanks. Your note was sent.
            </div>
        </div>
    </p-dialog>
</aside>

<div class="backdrop" *ngIf="drawerOpen()" (click)="toggleDrawer()" aria-hidden="true"></div>
