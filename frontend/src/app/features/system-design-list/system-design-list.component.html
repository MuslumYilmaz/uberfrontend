<div class="fa-page-shell sd-list-page">
    <header class="fa-page-header">
        <p class="fa-page-kicker">Architecture prep</p>
        <h1 class="fa-page-title">System Design</h1>
        <p class="fa-page-subtitle">Review distributed-system interview scenarios with curated solution patterns.</p>
    </header>

    <div class="sd-filter-bar fa-section-shell">
        <div class="sd-search-wrap">
            <i class="pi pi-search sd-search-icon"></i>
            <input pInputText type="text" placeholder="Search by title or tag…"
                class="sd-search-input"
                [(ngModel)]="searchTerm"
                (ngModelChange)="search$.next($event)" [ngModelOptions]="{ standalone: true }" />
        </div>

        <div class="sd-tag-filter-wrap">
            <p-multiSelect class="tag-filter w-full" [options]="(tagOptions$ | async) ?? []" placeholder="Tags"
                display="chip" panelStyleClass="dark-multiselect-panel rounded-lg" (onChange)="tags$.next($event.value)"
                optionLabel="label" optionValue="value">
            </p-multiSelect>
        </div>
    </div>

    <div class="sd-list-table fa-section-shell">
        <div class="sd-table-head hidden md:grid grid-cols-12 gap-4">
            <div class="col-span-8">Title</div>
            <div class="col-span-3">Tags</div>
            <div class="col-span-1 text-right">Action</div>
        </div>

        <ng-container *ngIf="(rawQuestions$ | async) === null; else loaded">
            <div class="sd-loading" role="status" aria-live="polite" data-testid="system-design-list-loading">
                <p-progressSpinner></p-progressSpinner>
                <div class="sd-loading-text">Loading system design questions…</div>
            </div>
        </ng-container>

        <ng-template #loaded>
            <ng-container *ngIf="filtered$ | async as questions">
                <div *ngIf="questions.length === 0" class="fa-empty-state">
                    No questions match your filters.
                </div>

                <div *ngFor="let q of questions; trackBy: trackById"
                    class="sd-row grid grid-cols-1 md:grid-cols-12 gap-3 md:gap-4 items-start md:items-center relative"
                    [class.is-locked]="isLocked(q)">
                    <a [routerLink]="[q.id]" class="absolute inset-0 z-10"
                        [attr.aria-disabled]="isLocked(q) ? true : null"
                        (click)="handleRowClick($event, q)"></a>

                    <div class="md:col-span-8">
                        <div class="sd-row-title">
                            {{ q.title }}
                            <span class="premium-pill" *ngIf="isLocked(q)">Premium</span>
                        </div>
                        <div class="sd-row-desc">{{ q.description | slice:0:120 }}...</div>
                    </div>

                    <div class="md:col-span-3 flex flex-wrap gap-2">
                        <p-chip *ngFor="let tag of q.tags" [label]="tag" styleClass="custom-chip"></p-chip>
                    </div>

                    <div class="hidden md:block md:col-span-1 text-right">
                        <div class="sd-row-action">
                            <span>→</span><span>Open</span>
                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-template>
    </div>
</div>
