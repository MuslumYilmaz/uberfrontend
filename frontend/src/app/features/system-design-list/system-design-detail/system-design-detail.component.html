<div class="sdl-root">
    <div class="sdl-main">
        <!-- LEFT : fixed rail -->
        <aside class="left">
            <div class="left-inner">
                <div class="left-head">
                    <h1 class="title" [title]="title()">{{ title() }}</h1>
                </div>

                <div class="left-body">
                    <div class="desc">{{ description() }}</div>
                    <div class="tags">
                        <p-chip *ngFor="let tag of tags()" [label]="tag" styleClass="custom-chip"></p-chip>
                    </div>
                </div>

                <div class="left-foot">
                    <div class="guide">
                        New to RADIO?
                        <a routerLink="/guides/radio">Read the guide</a> first.
                    </div>
                </div>
            </div>
        </aside>

        <!-- CENTER : article -->
        <main class="center" #centerEl>
            <ng-container *ngFor="let s of sections()">
                <section class="sd-section" [attr.id]="anchorId(s.key)">
                    <h2 class="sd-h2" #sectionHeading [attr.data-key]="s.key">{{ s.title }}</h2>

                    <div class="sd-blocks">
                        <ng-container *ngIf="s.blocks?.length; else legacyText">
                            <ng-container *ngFor="let b of s.blocks; let bi = index">
                                <!-- TEXT -->
                                <div *ngIf="b.type === 'text'" class="sd-text">{{ b.text }}</div>

                                <!-- CODE (Monaco, lazy via IntersectionObserver) -->
                                <div *ngIf="b.type === 'code'" class="sd-code"
                                    [style.minHeight.px]="!isCodeMounted(codeKey(s.key, bi)) ? (b.height || 160) : (b.height || null)">
                                    <!-- Show skeleton OR editor (never both) -->
                                    <div *ngIf="!isCodeMounted(codeKey(s.key, bi)); else showCode" #codeSentinel
                                        class="code-sentinel" [attr.data-code-id]="codeKey(s.key, bi)"></div>

                                    <ng-template #showCode>
                                        <app-monaco-editor class="sd-code-fill" [code]="b.code"
                                            [language]="b.language || 'typescript'" [readOnly]="true"
                                            [interactive]="false" [autoHeight]="!b.height" [options]="codeViewerOptions"
                                            [style.height.px]="b.height || null"></app-monaco-editor>
                                    </ng-template>
                                </div>

                                <!-- IMAGE -->
                                <figure *ngIf="b.type === 'image'" class="sd-figure">
                                    <picture>
                                        <source *ngIf="b.srcAvif" [attr.srcset]="asset(b.srcAvif)" type="image/avif" />
                                        <source *ngIf="b.srcWebp" [attr.srcset]="asset(b.srcWebp)" type="image/webp" />
                                        <img [src]="asset(b.src)" [alt]="b.alt || ''" [attr.width]="b.width || null"
                                            [attr.height]="b.height || null"
                                            [attr.loading]="b.priority ? 'eager' : 'lazy'"
                                            [attr.decoding]="b.priority ? 'sync' : 'async'" />
                                    </picture>
                                    <figcaption *ngIf="b.caption">{{ b.caption }}</figcaption>
                                </figure>

                                <!-- CHECKLIST -->
                                <div *ngIf="b.type === 'checklist'" class="sd-checklist">
                                    <div class="sd-checklist-title" *ngIf="b.title">
                                        {{ b.title }}
                                    </div>
                                    <ul class="sd-checklist-list">
                                        <li *ngFor="let item of b.items">
                                            <span class="sd-checklist-bullet"></span>
                                            <span class="sd-checklist-text">{{ item }}</span>
                                        </li>
                                    </ul>
                                </div>

                                <!-- CALLOUT -->
                                <div *ngIf="b.type === 'callout'" class="sd-callout"
                                    [class.sd-callout-info]="!b.variant || b.variant === 'info'"
                                    [class.sd-callout-success]="b.variant === 'success'"
                                    [class.sd-callout-warning]="b.variant === 'warning'"
                                    [class.sd-callout-danger]="b.variant === 'danger'">
                                    <div class="sd-callout-title" *ngIf="b.title">
                                        {{ b.title }}
                                    </div>
                                    <div class="sd-callout-text">
                                        {{ b.text }}
                                    </div>
                                </div>

                                <!-- TABLE -->
                                <div *ngIf="b.type === 'table'" class="sd-table">
                                    <div class="sd-table-title" *ngIf="b.title">{{ b.title }}</div>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th *ngFor="let col of b.columns">{{ col }}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let row of b.rows">
                                                <td *ngFor="let cell of row">{{ cell }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-container>
                        </ng-container>

                        <ng-template #legacyText>
                            <div class="sd-text">{{ s.content }}</div>
                        </ng-template>
                    </div>
                </section>
            </ng-container>
        </main>

        <!-- RIGHT : fixed TOC -->
        <nav class="right">
            <div class="toc">
                <div class="toc-head">On this page</div>
                <ul class="toc-list">
                    <li *ngFor="let s of sections()">
                        <button class="toc-item" [class.active]="activeKey()===s.key" (click)="scrollToKey(s.key)">
                            {{ s.title }}
                        </button>
                    </li>
                </ul>
                <div class="toc-foot">
                    <button class="top-btn" (click)="scrollTop()">Back to top</button>
                </div>
            </div>
        </nav>
    </div>

    <app-footer></app-footer>
</div>