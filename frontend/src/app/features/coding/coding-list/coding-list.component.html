<div class="container mx-auto max-w-7xl px-4 py-6">

  <!-- Tech / Formats pills -->
  <div class="container mx-auto max-w-7xl px-4 py-6">

    <app-coding-tech-kind-tabs *ngIf="source!=='company'" [source]="source" [techTabs]="techTabs" [kindTabs]="kindTabs"
      [tech]="tech ?? null" [kind]="kind" [viewMode]="viewMode" [selectedTech]="selectedTech$ | async"
      [selectedKind]="selectedKind$ | async" [selectedCategory]="selectedCategory$ | async"
      [isSystemCategoryActive]="(isSystemCategoryActive$ | async) ?? false"
      [filteredCount]="(filteredCount$ | async) || 0" (techSelected)="toggleTech($event)"
      (categoryToggled)="toggleCategory($event)" (kindSelected)="selectKind($event)"></app-coding-tech-kind-tabs>


    <!-- Filter Bar -->
    <app-coding-filter-panel [searchTerm]="searchTerm" [difficultySelection]="(diffs$ | async) || []"
      [importanceSelection]="(impTiers$ | async) || []" [popularTags]="(popularTags$ | async) || []"
      [selectedTags]="(selectedTags$ | async) || []" [tagMatchMode]="tagMatchMode" [sortOpen]="sortOpen"
      [sortOptions]="sortOptions" [currentSort]="(sort$ | async) || 'default'"
      (searchTermChange)="onSearchTermChange($event)" (difficultyChange)="onDifficultyToggleFromChild($event)"
      (importanceChange)="onImportanceToggleFromChild($event)" (tagToggled)="toggleTag($event)"
      (clearAllTags)="clearAllTags()" (tagMatchModeToggle)="toggleTagMatchMode()" (sortToggle)="toggleSort()"
      (sortClose)="closeSort()" (sortChange)="setSort($event)">
    </app-coding-filter-panel>

    <!-- Data -->
    <div class="list">
      <ng-container *ngIf="filtered$ | async as questions; else loading">
        <div *ngIf="questions.length === 0" class="py-6 text-center italic text-gray-500">
          No questions match your filters.
        </div>

        <!-- Rows -->
        <div *ngFor="let q of questions" class="list-row grid grid-cols-12 gap-4 items-center px-6 py-4 relative">
          <a [routerLink]="linkTo(q)" [state]="stateForNav(questions, q, (companySlug$ | async) || null)"
            class="absolute inset-0 z-10"></a>

          <div class="col-span-5">
            <div class="text-lg font-semibold text-white">{{ q.title }}</div>

            <!-- description line -->
            <div class="text-xs text-gray-400 mt-0.5 desc-tip-target" [pTooltip]="descriptionText(q)"
              tooltipPosition="bottom" appendTo="body" [tooltipStyleClass]="'desc-tip'" [showDelay]="150"
              [hideDelay]="0" [autoHide]="true" [life]="0" [escape]="false" [tooltipDisabled]="!descriptionText(q)"
              (click)="go(q, questions)" tabindex="0" (keydown.enter)="go(q, questions)">
              {{ preview(descriptionText(q), 120) }}
            </div>

            <div class="framework-switcher relative z-20" *ngIf="frameworkOptions(q).length > 1">
              <div class="fw-label-row">
                <span class="fw-label">Framework versions</span>
                <span class="fw-hint">Open this challenge in your stack</span>
              </div>
              <div class="fw-chip-row">
                <button
                  *ngFor="let opt of frameworkOptions(q)"
                  type="button"
                  class="fw-chip"
                  [class.active]="opt.id === q.id"
                  [attr.aria-label]="'Open '+frameworkLabel(opt.tech)+' version'"
                  (click)="goToFramework($event, opt)">
                  <span class="fw-chip-label">{{ frameworkLabel(opt.tech) }}</span>
                  <span class="fw-cta">Open</span>
                </button>
              </div>
            </div>
          </div>


          <div class="col-span-2">
            <span class="px-2 py-1 rounded text-xs font-medium" [ngClass]="{
            'bg-green-800 text-green-300': q.difficulty === 'easy',
            'bg-yellow-800 text-yellow-300': q.difficulty === 'intermediate',
            'bg-red-800 text-red-300': q.difficulty === 'hard'
          }">{{ q.difficulty | titlecase }}</span>
          </div>

          <div class="col-span-1">
            <span class="imp-chip" [ngClass]="{
          'imp-low':    impLabel(q)==='low',
          'imp-medium': impLabel(q)==='medium',
          'imp-high':   impLabel(q)==='high'
        }">
              {{ impLabel(q) | titlecase }}
            </span>
          </div>

          <!-- Show the tech badge when not on per-tech page -->
          <div class="col-span-1" *ngIf="source!=='tech'">
            <span class="px-2 py-1 rounded text-xs bg-white/10 text-gray-200">{{ techName(q) }}</span>
          </div>

          <!-- from: gap-2 -->
          <div class="col-span-2 flex flex-wrap gap-1">
            <p-chip *ngFor="let tag of (q.tags || [])" [label]="tag"
              [styleClass]="'custom-chip tag-clickable ' + ((selectedTags$ | async)?.includes(tag) ? 'active' : '')"
              (click)="toggleTag(tag)">
            </p-chip>
          </div>

          <div class="col-span-1 text-right">
            <div class="text-blue-400 hover:text-blue-500 font-medium flex items-center gap-1">
              <span>â†’</span>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #loading>
        <div class="py-10 flex justify-center">
          <p-progressSpinner styleClass="text-blue-500"></p-progressSpinner>
        </div>
      </ng-template>
    </div>

    <app-offline-banner></app-offline-banner>
  </div>
