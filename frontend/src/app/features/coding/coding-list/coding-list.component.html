<div class="container mx-auto max-w-7xl px-4 py-6">

  <!-- Tech / Formats pills -->
  <div *ngIf="source!=='company'" class="mb-4 overflow-x-auto">
    <nav class="flex items-center gap-2 min-w-max">

      <!-- GLOBAL (/coding): choose by viewMode -->
      <ng-container *ngIf="source==='global-coding'">
        <!-- Formats mode: CATEGORY pills -->
        <ng-container *ngIf="(viewMode$ | async) === 'formats'; else globalTechPills">
          <button *ngFor="let c of categoryTabs" type="button" class="tab-pill"
            [ngClass]="(selectedCategory$ | async) === c.key ? 'tab-pill--active' : 'tab-pill--idle'"
            (click)="toggleCategory(c.key)">
            <span class="whitespace-nowrap">{{ c.label }}</span>
          </button>
        </ng-container>

        <!-- Tech mode: TECH filter pills -->
        <ng-template #globalTechPills>
          <button *ngFor="let t of techTabs" type="button" class="tab-pill"
            [ngClass]="(selectedTech$ | async) === t.key ? 'tab-pill--active' : 'tab-pill--idle'"
            (click)="toggleTech(t.key)">
            <span class="tech-badge" [ngClass]="t.cls">{{ t.badge }}</span>
            <span class="whitespace-nowrap">{{ t.label }}</span>
          </button>
        </ng-template>
      </ng-container>

      <!-- Per-tech routes: navigation pills -->
      <ng-container *ngIf="source!=='global-coding'">
        <a *ngFor="let t of techTabs" [routerLink]="['/', t.key, kind]" class="tab-pill"
          [ngClass]="t.key === tech ? 'tab-pill--active' : 'tab-pill--idle'">
          <span class="tech-badge" [ngClass]="t.cls">{{ t.badge }}</span>
          <span class="whitespace-nowrap">{{ t.label }}</span>
        </a>
      </ng-container>

    </nav>
  </div>

  <!-- Section tabs + right-side count -->
<div *ngIf="source!=='company'" class="tabs-row">
  <div class="tabs-left">

    <!-- GLOBAL (/coding): render kind pills unless System design is active -->
    <ng-container *ngIf="source==='global-coding'; else perTechKindLinks">
      <ng-container *ngIf="!(isSystemCategoryActive$ | async)">
        <button type="button" class="kind-pill"
          [ngClass]="(selectedKind$ | async) === 'coding' ? 'kind-pill--active' : 'kind-pill--idle'"
          (click)="selectKind('coding')">Coding</button>

        <button type="button" class="kind-pill"
          [ngClass]="(selectedKind$ | async) === 'trivia' ? 'kind-pill--active' : 'kind-pill--idle'"
          (click)="selectKind('trivia')">Quiz</button>

        <button type="button" class="kind-pill"
          [ngClass]="(selectedKind$ | async) === 'debug' ? 'kind-pill--active' : 'kind-pill--idle'"
          (click)="selectKind('debug')">Debug</button>
      </ng-container>
      <!-- when System design is active, this block renders nothing -->
    </ng-container>

    <!-- PER-TECH pages: show nav links -->
    <ng-template #perTechKindLinks>
      <a *ngFor="let k of kindTabs" [routerLink]="['/', tech || 'javascript', k.key]" class="kind-pill"
         [ngClass]="k.key === kind ? 'kind-pill--active' : 'kind-pill--idle'">
        {{ k.label }}
      </a>
    </ng-template>

  </div>

  <div class="tabs-right">
    <span class="count-chip">{{ filteredCount$ | async }} questions</span>
  </div>
</div>


  <h1 class="text-4xl font-extrabold text-white mb-6">
    {{ heading() }}
  </h1>

  <!-- Filter Bar -->
  <div class="filter-bar p-4 rounded-xl shadow-sm flex flex-col md:flex-row items-center md:space-x-6 mb-8 gap-4">
    <div class="flex-1 w-full md:w-1/2">
      <div class="relative">
        <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        <input pInputText type="text" placeholder="Search by title…"
          class="w-full pl-10 pr-4 py-2 bg-gray-900 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          [(ngModel)]="searchTerm" (ngModelChange)="search$.next($event)" [ngModelOptions]="{ standalone: true }" />
      </div>
    </div>

    <div class="w-full md:w-auto flex-1">
      <p-multiSelect class="difficulty-filter w-full" [options]="difficultyOptions" placeholder="Difficulty"
        display="chip" panelStyleClass="dark-multiselect-panel rounded-lg" (onChange)="diffs$.next($event.value)"
        optionLabel="label" optionValue="value">
      </p-multiSelect>
    </div>

    <div class="w-full md:w-auto flex-1">
      <label class="block mb-1 text-sm font-medium text-gray-300">Max Importance</label>
      <p-slider [(ngModel)]="sliderValue" [min]="1" [max]="5" [step]="1" class="w-full"
        (ngModelChange)="maxImp$.next($event)">
      </p-slider>
    </div>
  </div>

  <!-- Data -->
  <div class="list">
    <ng-container *ngIf="filtered$ | async as questions; else loading">
      <div *ngIf="questions.length === 0" class="py-6 text-center italic text-gray-500">
        No questions match your filters.
      </div>

      <!-- Rows -->
      <div *ngFor="let q of questions" class="list-row grid grid-cols-12 gap-4 items-center px-6 py-4 relative">
        <a [routerLink]="linkTo(q)" [state]="stateForNav(questions, q, (companySlug$ | async) || null)"
          class="absolute inset-0 z-10"></a>

        <div class="col-span-5">
          <div class="text-lg font-semibold text-white">{{ q.title }}</div>
          <div class="text-xs text-gray-400 mt-0.5">{{ descriptionText(q) | slice:0:80 }}&hellip;</div>
        </div>

        <div class="col-span-2">
          <span class="px-2 py-1 rounded text-xs font-medium" [ngClass]="{
            'bg-green-800 text-green-300': q.difficulty === 'easy',
            'bg-yellow-800 text-yellow-300': q.difficulty === 'intermediate',
            'bg-red-800 text-red-300': q.difficulty === 'hard'
          }">{{ q.difficulty | titlecase }}</span>
        </div>

        <div class="col-span-1">
          <div class="text-sm text-gray-200">{{ q.importance }}</div>
        </div>

        <!-- Show the tech badge when not on per-tech page -->
        <div class="col-span-1" *ngIf="source!=='tech'">
          <span class="px-2 py-1 rounded text-xs bg-white/10 text-gray-200">{{ techName(q) }}</span>
        </div>

        <div class="col-span-2 flex flex-wrap gap-2">
          <p-chip *ngFor="let tag of (q.tags || [])" [label]="tag" styleClass="custom-chip"></p-chip>
        </div>

        <div class="col-span-1 text-right">
          <div class="text-blue-400 hover:text-blue-500 font-medium flex items-center gap-1">
            <span>→</span><span>Open</span>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #loading>
      <div class="py-10 flex justify-center">
        <p-progressSpinner styleClass="text-blue-500"></p-progressSpinner>
      </div>
    </ng-template>
  </div>
</div>