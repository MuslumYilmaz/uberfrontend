<!-- Filter Bar -->
<div class="filter-bar p-4 rounded-xl shadow-sm flex flex-col md:flex-row items-center md:space-x-6 mb-8 gap-4">
    <div class="section flex-1 w-full md:w-1/2">
        <div class="relative">
            <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            <input pInputText type="text" placeholder="Search by title…"
                class="w-full pl-10 pr-4 py-2 bg-gray-900 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                [(ngModel)]="searchTerm" (ngModelChange)="searchTermChange.emit($event)"
                [ngModelOptions]="{ standalone: true }" />
        </div>
    </div>

    <!-- Difficulty -->
    <div class="section w-full md:w-auto flex-1">
        <fieldset class="diff-group">
            <legend class="diff-legend">Difficulty</legend>

            <label class="diff-option" [class.diff-option--checked]="isDiffChecked('easy')">
                <input type="checkbox" [checked]="isDiffChecked('easy')"
                    (change)="onDifficultyInputChange('easy', $event)" />
                <span>Beginner</span>
            </label>

            <label class="diff-option" [class.diff-option--checked]="isDiffChecked('intermediate')">
                <input type="checkbox" [checked]="isDiffChecked('intermediate')"
                    (change)="onDifficultyInputChange('intermediate', $event)" />
                <span>Intermediate</span>
            </label>

            <label class="diff-option" [class.diff-option--checked]="isDiffChecked('hard')">
                <input type="checkbox" [checked]="isDiffChecked('hard')"
                    (change)="onDifficultyInputChange('hard', $event)" />
                <span>Advanced</span>
            </label>
        </fieldset>
    </div>

    <!-- Importance -->
    <div class="section w-full md:w-auto flex-1">
        <fieldset class="diff-group">
            <legend class="diff-legend">Importance</legend>

            <label class="diff-option" [class.diff-option--checked]="isImpChecked('low')">
                <input type="checkbox" [checked]="isImpChecked('low')"
                    (change)="onImportanceInputChange('low', $event)" />
                <span>Low</span>
            </label>

            <label class="diff-option" [class.diff-option--checked]="isImpChecked('medium')">
                <input type="checkbox" [checked]="isImpChecked('medium')"
                    (change)="onImportanceInputChange('medium', $event)" />
                <span>Medium</span>
            </label>

            <label class="diff-option" [class.diff-option--checked]="isImpChecked('high')">
                <input type="checkbox" [checked]="isImpChecked('high')"
                    (change)="onImportanceInputChange('high', $event)" />
                <span>High</span>
            </label>
        </fieldset>
    </div>
</div>

<!-- Tag filter + Sort -->
<div class="tag-filter" *ngIf="popularTags?.length">
    <div class="tag-filter__header">
        <span class="tag-filter__legend">
            <i class="pi pi-filter mr-1"></i> Filter by tags
        </span>

        <!-- RIGHT SIDE: selected meta + Sort -->
        <div class="tag-filter__right">
            <div class="tag-filter__meta" *ngIf="selectedTags as sel">
                <span class="tag-filter__count" *ngIf="sel.length">{{ sel.length }} selected</span>

                <button type="button" class="tag-filter__mode" (click)="tagMatchModeToggle.emit()">
                    {{ tagMatchMode === 'all' ? 'Match all' : 'Match any' }}
                </button>

                <button *ngIf="sel.length" class="tag-clear" (click)="clearAllTags.emit()">Clear</button>
            </div>

            <!-- Sort by -->
            <div class="sort-wrap" (keydown.escape)="sortClose.emit()" [class.open]="sortOpen">
                <button type="button" class="sort-btn" (click)="sortToggle.emit()">
                    <i class="pi pi-sliders-h"></i>
                    <span>Sort by</span>
                    <i class="pi pi-chevron-down chevron" [class.up]="sortOpen"></i>
                </button>

                <div class="sort-menu" *ngIf="sortOpen" role="menu" aria-label="Sort options">
                    <button *ngFor="let opt of sortOptions" role="menuitemradio"
                        [attr.aria-checked]="currentSort === opt.key" class="sort-item"
                        [class.active]="currentSort === opt.key" (click)="sortChange.emit(opt.key)">
                        <span class="label">{{ opt.label }}</span>
                        <span class="kbd" *ngIf="opt.hint">{{ opt.hint }}</span>
                        <span class="check" aria-hidden="true">✓</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="tag-scrollbar" role="listbox" aria-label="Filter by tags">
        <button *ngFor="let tag of popularTags" class="tag-scroll-chip" [class.active]="isTagSelected(tag)"
            (click)="tagToggled.emit(tag)">
            {{ tag }}
        </button>
    </div>
</div>