<ng-container *ngIf="track as t; else missing">
  <div class="track">
    <div class="container">
      <nav class="breadcrumb">
        <a routerLink="/tracks">Tracks</a>
        <span>/</span>
        <span class="crumb-current">{{ t.title }}</span>
      </nav>

      <div class="hero-card">
        <h1>{{ t.title }}</h1>
        <p class="subtitle">{{ t.subtitle }}</p>

        <div class="pill-row below-title">
          <span class="pill primary chip-pace">{{ t.durationLabel }}</span>
          <span class="pill soft">{{ t.featured.length }} questions</span>
        </div>

        <div class="focus bullets">
          <span class="chip bullet" *ngFor="let item of t.focus">{{ item }}</span>
        </div>

        <div class="hero-meta">
          <div class="meta-title">What’s inside</div>
          <div class="meta-body">
            <div>All frameworks + HTML/CSS/JS</div>
            <div>System design prompts included</div>
          </div>
        </div>
      </div>

      <ng-container *ngIf="filtered$ | async as featured">
        <div class="filters">
          <div class="filter-row tabs-row-inline">
            <div class="tab-group">
              <div class="tab-label">Type</div>
              <div class="tab-row">
                <uf-chip size="md" class="filter-chip" label="All"
                         [selected]="kindFilter$.value === 'all'"
                         (selectedChange)="onKindChange('all')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="Coding"
                         [selected]="kindFilter$.value === 'coding'"
                         (selectedChange)="onKindChange('coding')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="Trivia"
                         [selected]="kindFilter$.value === 'trivia'"
                         (selectedChange)="onKindChange('trivia')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="System design"
                         [selected]="kindFilter$.value === 'system-design'"
                         (selectedChange)="onKindChange('system-design')">
                </uf-chip>
              </div>
            </div>

            <div class="tab-group">
              <div class="tab-label">Tech</div>
              <div class="tab-row">
                <uf-chip size="md" class="filter-chip" label="All tech"
                         [selected]="techFilter$.value === 'all'"
                         (selectedChange)="onTechChange('all')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="JavaScript"
                         [selected]="techFilter$.value === 'javascript'"
                         (selectedChange)="onTechChange('javascript')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="React"
                         [selected]="techFilter$.value === 'react'"
                         (selectedChange)="onTechChange('react')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="Angular"
                         [selected]="techFilter$.value === 'angular'"
                         (selectedChange)="onTechChange('angular')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="Vue"
                         [selected]="techFilter$.value === 'vue'"
                         (selectedChange)="onTechChange('vue')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="HTML"
                         [selected]="techFilter$.value === 'html'"
                         (selectedChange)="onTechChange('html')">
                </uf-chip>
                <uf-chip size="md" class="filter-chip" label="CSS"
                         [selected]="techFilter$.value === 'css'"
                         (selectedChange)="onTechChange('css')">
                </uf-chip>
              </div>
            </div>
          </div>

          <app-coding-filter-panel
            [searchTerm]="searchTerm"
            [difficultySelection]="difficultySelection"
            [importanceSelection]="importanceSelection"
            [popularTags]="popularTags"
            [selectedTags]="selectedTags"
            [tagMatchMode]="tagMatchMode"
            [sortOpen]="sortOpen"
            [sortOptions]="sortOptions"
            [currentSort]="sort$.value"
            (searchTermChange)="onSearch($event)"
            (difficultyChange)="onDifficultyChange($event)"
            (importanceChange)="onImportanceChange($event)"
            (tagToggled)="onTagToggled($event)"
            (clearAllTags)="onClearTags()"
            (tagMatchModeToggle)="onTagMatchToggle()"
            (sortToggle)="toggleSort()"
            (sortClose)="closeSort()"
            (sortChange)="setSort($event)">
          </app-coding-filter-panel>
        </div>

        <section class="list">
          <div class="list-head">
            <div class="list-title">
              <span class="list-kicker">Featured questions</span>
              <span class="count">{{ featured.length }}</span>
            </div>
            <div class="note">Pace yourself — no daily check-ins.</div>
          </div>

          <div class="question" *ngFor="let item of featured">
            <div class="q-header">
              <div class="labels">
                <span class="pill tiny category-pill">
                  <span class="pill-icon">{{ categoryIcon(item) }}</span>
                  {{ categoryLabel(item) }}
                </span>
                <span class="pill tiny alt">
                  {{ item.kind === 'system-design' ? 'System design' : (item.kind | titlecase) }}
                </span>
                <span class="pill tiny diff" [ngClass]="diffClass(item.difficulty)">
                  {{ displayDifficulty(item.difficulty) }}
                </span>
              </div>
              <a class="link" [routerLink]="linkFor(item)" [state]="navState(featured, item)">Open →</a>
            </div>

            <div class="q-title">{{ item.title }}</div>
            <div class="q-desc" *ngIf="item.description">{{ preview(item.description) }}</div>

            <div class="fw-switcher" *ngIf="frameworkOptions(item).length > 1">
              <div class="fw-label-row">
                <span class="fw-label">Framework versions</span>
                <span class="fw-hint">Open in your stack</span>
              </div>
              <div class="fw-chip-row">
                <button
                  type="button"
                  class="fw-chip"
                  *ngFor="let opt of frameworkOptions(item)"
                  [class.active]="opt.id === item.id"
                  (click)="goToFramework($event, opt)">
                  <span class="fw-chip-label">{{ frameworkLabel(opt.tech) }}</span>
                  <span class="fw-cta">Open</span>
                </button>
              </div>
            </div>

            <div class="tags" *ngIf="item.tags?.length">
              <span class="tag" *ngFor="let tag of item.tags">{{ tag }}</span>
            </div>
          </div>
        </section>
      </ng-container>
    </div>
  </div>
</ng-container>

<ng-template #missing>
  <div class="track">
    <div class="container">
      <a class="back" routerLink="/tracks">← All tracks</a>
      <h1>Track not found</h1>
      <p class="subtitle">Pick a track from the list to see its question set.</p>
    </div>
  </div>
</ng-template>
