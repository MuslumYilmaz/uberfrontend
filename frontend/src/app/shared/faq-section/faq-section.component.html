<section class="faq-section">
  <div class="section-head" *ngIf="title || subtitle">
    <div>
      <p class="eyebrow" *ngIf="eyebrow">{{ eyebrow }}</p>
      <h2 class="faq-title" *ngIf="title">{{ title }}</h2>
    </div>
    <p class="muted" *ngIf="subtitle">{{ subtitle }}</p>
  </div>

  <div class="faq-card glass" role="region" aria-label="Frequently asked questions">
    <ng-container *ngIf="groups?.length; else flatFaq">
      <div class="faq-group" *ngFor="let group of groups; let gi = index; trackBy: trackByGroup">
        <div class="faq-group-title">{{ group.title }}</div>

        <div class="faq-item" *ngFor="let item of group.items; let i = index; trackBy: trackById">
          <button
            type="button"
            class="faq-q"
            (click)="toggle(getId(item, i, getGroupKey(group, gi)))"
            [attr.aria-expanded]="isOpen(getId(item, i, getGroupKey(group, gi)))"
            [attr.aria-controls]="'faq-a-' + getId(item, i, getGroupKey(group, gi))">
            <span class="faq-q-text">{{ item.q }}</span>
            <i class="pi pi-chevron-down faq-icon" aria-hidden="true"
              [class.open]="isOpen(getId(item, i, getGroupKey(group, gi)))"></i>
          </button>

          <div
            class="faq-a"
            [class.open]="isOpen(getId(item, i, getGroupKey(group, gi)))"
            [attr.id]="'faq-a-' + getId(item, i, getGroupKey(group, gi))"
            role="region">
            <p [innerHTML]="item.a | safeHtml"></p>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #flatFaq>
      <div class="faq-item" *ngFor="let item of items; let i = index; trackBy: trackById">
        <button
          type="button"
          class="faq-q"
          (click)="toggle(getId(item, i))"
          [attr.aria-expanded]="isOpen(getId(item, i))"
          [attr.aria-controls]="'faq-a-' + getId(item, i)">
          <span class="faq-q-text">{{ item.q }}</span>
          <i class="pi pi-chevron-down faq-icon" aria-hidden="true" [class.open]="isOpen(getId(item, i))"></i>
        </button>

        <div
          class="faq-a"
          [class.open]="isOpen(getId(item, i))"
          [attr.id]="'faq-a-' + getId(item, i)"
          role="region">
          <p [innerHTML]="item.a | safeHtml"></p>
        </div>
      </div>
    </ng-template>
  </div>
</section>
