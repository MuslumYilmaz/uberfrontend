{
    "key": "A",
    "title": "Architecture / High-level design",
    "blocks": [
        {
            "type": "text",
            "text": "Here the interviewer wants to see a frontend upload pipeline, not just a file input. You should structure the component into clear layers: UI, validation/preprocess, upload manager, and API integration."
        },
        {
            "type": "divider"
        },
        {
            "type": "columns",
            "columns": [
                {
                    "blocks": [
                        {
                            "type": "text",
                            "text": "**How you should frame the architecture:**\n\"Iâ€™d build a small client pipeline: UI layer (control, preview, status), a validator/preprocessor (type/size/dimensions + optional resize), an UploadManager (queue, progress, cancel, retry), and a thin API client for getting upload URLs. The UI is just a state machine driven by that pipeline.\""
                        }
                    ]
                },
                {
                    "blocks": [
                        {
                            "type": "text",
                            "text": "**What the interviewer listens for:**\n- A clear **state model** instead of ad-hoc booleans.\n- A predictable **data flow** (select -> validate -> preprocess -> upload -> finalize).\n- Separation of concerns: **UI**, **validation/preprocess**, **upload manager**, **API client**.\n- Awareness of **object URL lifecycle** (create + revoke).\n- Main-thread safety for image work (worker/offscreen when possible)."
                        }
                    ]
                }
            ]
        },
        {
            "type": "callout",
            "variant": "info",
            "title": "How you should act here",
            "text": "Describe the component as if it ships to millions: a state machine in the UI, a preprocessing step for images, and an upload manager that can retry/cancel safely. Keep each layer small and testable."
        },
        {
            "type": "divider"
        },
        {
            "type": "code",
            "language": "ts",
            "code": "// High-level state model\n\ntype UploadStatus =\n  | 'idle'\n  | 'validating'\n  | 'preprocessing'\n  | 'uploading'\n  | 'uploaded'\n  | 'error';\n\ninterface ImageUploadState {\n  file: File | null;\n  previewUrl: string | null;\n  status: UploadStatus;\n  progress: number; // 0..100\n  error: string | null;\n}\n\n// Pipeline layers\n// 1) validateFile(file) -> ok/error\n// 2) preprocessImage(file) -> { file, previewUrl }\n// 3) uploadManager.upload(file, onProgress, signal)\n"
        },
        {
            "type": "table",
            "title": "High-level pieces you should mention",
            "columns": [
                "Piece",
                "Responsibility",
                "Notes"
            ],
            "rows": [
                [
                    "State machine",
                    "Tracks `status`, `file`, `previewUrl`, `error`",
                    "Single source of truth for UI; every visual state maps to a combination of these fields."
                ],
                [
                    "Control area",
                    "File input + optional dropzone",
                    "Handles `onChange` / `onDrop`, forwards the File object into validation, remains keyboard-accessible."
                ],
                [
                    "Preview area",
                    "Displays thumbnail when there is a valid `previewUrl`",
                    "Keeps aspect ratio, responsive layout, hides itself in idle/error states."
                ],
                [
                    "Status bar",
                    "Shows progress, retry, cancel, or uploaded state",
                    "Progress updates should be throttled to avoid re-render storms."
                ],
                [
                    "Actions",
                    "Replace / Remove buttons",
                    "Replace opens picker again, Remove clears state and revokes object URL."
                ],
                [
                    "Validation + preprocess",
                    "Pure helpers or worker",
                    "Keep resize/compress off the main thread when possible."
                ],
                [
                    "Upload manager",
                    "Queue, progress, cancel, retry",
                    "Encapsulates async upload behavior and exposes lifecycle events."
                ]
            ]
        },
        {
            "type": "divider"
        },
        {
            "type": "columns",
            "columns": [
                {
                    "blocks": [
                        {
                            "type": "checklist",
                            "title": "Architecture decisions you should highlight",
                            "items": [
                                "Use a **single, explicit status field** plus `progress` instead of many booleans.",
                                "Isolate **validation** and **preprocess** in helpers/worker.",
                                "Keep an **UploadManager** with cancel/retry and progress callbacks.",
                                "Use `URL.createObjectURL` only after validation passes, and **revoke** old URLs on replace/remove.",
                                "Make size/type limits **configurable via props**, so the component is reusable.",
                                "Throttle progress updates to avoid re-render storms."
                            ]
                        }
                    ]
                },
                {
                    "blocks": [
                        {
                            "type": "checklist",
                            "title": "Things you should avoid",
                            "items": [
                                "Mixing file validation, preview logic, and JSX all in one huge handler.",
                                "Never revoking object URLs, causing **memory leaks** on long sessions.",
                                "Hiding errors behind console logs instead of user-visible messages.",
                                "Tightly coupling the component to a specific backend API (keep the upload URL step abstract).",
                                "Using only icons or color to show errors or statuses (poor accessibility).",
                                "Relying solely on click interactions and ignoring keyboard/focus flows."
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "steps",
            "title": "Internal flow you should walk through",
            "steps": [
                {
                    "title": "1. Handle file selection/drop",
                    "text": "On input change or drop, pass the file into validation before touching state."
                },
                {
                    "title": "2. Validate + preprocess",
                    "text": "If validation passes, create a preview and optionally resize/compress (off-thread)."
                },
                {
                    "title": "3. Upload with progress",
                    "text": "Request a pre-signed URL, start upload via UploadManager, and emit progress updates."
                },
                {
                    "title": "4. Success or retry",
                    "text": "On success, set status to uploaded and emit the asset URL/id. On failure, show retry with backoff."
                },
                {
                    "title": "5. Replace / remove",
                    "text": "Replace restarts the flow; remove cancels upload, revokes preview URLs, and resets state."
                }
            ]
        },
        {
            "type": "stats",
            "items": [
                {
                    "label": "Core state fields",
                    "value": "5",
                    "helperText": "`file`, `previewUrl`, `status`, `progress`, `error`."
                },
                {
                    "label": "Main transitions",
                    "value": "idle -> preprocessing -> uploading -> uploaded",
                    "helperText": "With error + retry paths."
                },
                {
                    "label": "Main layers",
                    "value": "UI, Preprocess, UploadManager",
                    "helperText": "Each with a clear responsibility."
                }
            ]
        },
        {
            "type": "callout",
            "variant": "warning",
            "title": "Key message to land",
            "text": "This is not just a widget; it is a client pipeline. If you can describe UI -> preprocess -> upload manager -> finalize, you are speaking system design language."
        }
    ]
}
