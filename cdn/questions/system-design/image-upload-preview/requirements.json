{
    "key": "R",
    "title": "Reflect & Requirements",
    "blocks": [
        {
            "type": "text",
            "text": "In this step, treat Image Upload & Preview as a real frontend system: selection, validation, preprocessing, upload, and recovery. Your job is to show the full client-side pipeline and its states, not just a file input."
        },
        {
            "type": "divider"
        },
        {
            "type": "columns",
            "columns": [
                {
                    "blocks": [
                        {
                            "type": "text",
                            "text": "### What you’re designing\nYou’re designing a reusable `ImageUploadPreview` component that includes a real client pipeline:\n\n- Lets the user pick an image from their device.\n- Validates **type**, **size**, and **dimensions** before previewing.\n- Generates a preview with correct orientation (EXIF) and no layout shift.\n- Optionally resizes/compresses on the client to meet limits.\n- Uploads to a storage URL with **progress**, **cancel**, and **retry**.\n- Emits a stable asset URL/id back to the parent form.\n- Allows **replacing** or **removing** the image at any time.\n- Works well on mobile and is accessible by default."
                        }
                    ]
                },
                {
                    "blocks": [
                        {
                            "type": "text",
                            "text": "### What the interviewer is testing\n- Can you model the **full state machine** (idle, validating, preprocessing, uploading, uploaded, error)?\n- Do you handle **async flows** safely (cancel, retry, stale uploads)?\n- Do you keep **main-thread work** under control (resize/compress off-thread)?\n- Do you consider **network variability** and progress UX?\n- Do you build in **accessibility** and mobile UX from the start?"
                        }
                    ]
                }
            ]
        },
        {
            "type": "callout",
            "variant": "info",
            "title": "How you should act here",
            "text": "Walk through the full client pipeline: select -> validate -> preprocess -> preview -> request upload URL -> upload with progress -> finalize. At each step, call out UI, state, and error handling."
        },
        {
            "type": "divider"
        },
        {
            "type": "steps",
            "title": "User flow you should describe",
            "steps": [
                {
                    "title": "1. Initial state",
                    "text": "User sees a \"Choose image\" button (and/or dropzone). No preview yet."
                },
                {
                    "title": "2. Select + validate",
                    "text": "On file selection, validate type, size, and min dimensions. If invalid, show a specific error."
                },
                {
                    "title": "3. Preprocess",
                    "text": "If valid, generate a preview and optionally resize/compress (off the main thread if possible)."
                },
                {
                    "title": "4. Upload with progress",
                    "text": "Request a pre-signed upload URL, upload with progress, allow cancel, and retry on failure."
                },
                {
                    "title": "5. Success",
                    "text": "On completion, emit the uploaded asset URL/id to the parent and show an \"Uploaded\" state."
                },
                {
                    "title": "6. Replace / remove",
                    "text": "Replace restarts the flow and cleans old previews. Remove clears state and revokes object URLs."
                }
            ]
        },
        {
            "type": "columns",
            "columns": [
                {
                    "blocks": [
                        {
                            "type": "checklist",
                            "title": "Clarifying questions you should ask",
                            "items": [
                                "What image types are allowed (JPEG/PNG/WebP)?",
                                "What is the max file size before and after compression?",
                                "Minimum dimensions or aspect ratio requirements?",
                                "Do we need cropping or just preview?",
                                "Should uploads be resumable or chunked?",
                                "Do we get a pre-signed URL from the backend?",
                                "What should happen on slow networks (retry/backoff)?",
                                "Single image only, or future multi-image support?"
                            ]
                        }
                    ]
                },
                {
                    "blocks": [
                        {
                            "type": "checklist",
                            "title": "Non-functional expectations to confirm",
                            "items": [
                                "Keep main-thread work under 16ms per frame on mid-range devices.",
                                "Upload progress updates should not cause re-render storms.",
                                "Errors must be actionable and announced to assistive tech.",
                                "Object URLs must be revoked when replaced/removed.",
                                "The UI must stay responsive on slow or flaky networks.",
                                "Mobile layout and tap targets must be reliable."
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "table",
            "title": "Key states you should call out",
            "columns": [
                "State",
                "What the user sees",
                "What you store in state"
            ],
            "rows": [
                [
                    "Initial",
                    "A primary \"Choose image\" button (and optional drag area). No thumbnail, no status.",
                    "file: null, previewUrl: null, status: 'idle', error: null"
                ],
                [
                    "Validating",
                    "Short-lived; user just sees their click. Validation happens synchronously before UI update.",
                    "file: candidate file, status: 'validating' (optional), error: null"
                ],
                [
                    "Uploading",
                    "Thumbnail preview + \"Uploading…\" label/spinner. Replace/Remove may be disabled.",
                    "file: file, previewUrl: object URL, status: 'uploading', error: null"
                ],
                [
                    "Uploaded",
                    "Thumbnail + \"Uploaded\" (check icon). Buttons: \"Replace\" and \"Remove\".",
                    "file: file, previewUrl: object URL, status: 'uploaded', error: null"
                ],
                [
                    "Error",
                    "Error message below control (e.g. \"File too large\" or \"Unsupported format\"). No preview.",
                    "file: null (or previous file cleared), previewUrl: null, status: 'error', error: message"
                ]
            ]
        },
        {
            "type": "stats",
            "items": [
                {
                    "label": "Max file size",
                    "value": "≈ 10 MB",
                    "helperText": "Before compression; enforce a smaller post-process target."
                },
                {
                    "label": "Performance budget",
                    "value": "<= 16ms",
                    "helperText": "Keep preview/resize work off the main thread."
                },
                {
                    "label": "Supported types",
                    "value": "JPEG, PNG, WebP",
                    "helperText": "Use MIME validation, not extensions."
                }
            ]
        },
        {
            "type": "callout",
            "variant": "warning",
            "title": "Key message to land",
            "text": "This is a frontend system design question. Show the full client pipeline: validate, preprocess, upload, recover. If you can talk about progress, cancel/retry, and main-thread safety, it no longer feels like a small component."
        }
    ]
}
